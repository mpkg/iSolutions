<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Quick Address</title>
    <script src="http://code.jquery.com/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.10/jquery-ui.js" type="text/javascript"></script>
    <link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.10/themes/redmond/jquery-ui.css"
        rel="stylesheet" type="text/css" />
    <style type="text/css">
        .ui-autocomplete-loading
        {
            background: white url('images/ui-anim_basic_16x16.gif') right center no-repeat;
        }
        #searchBox
        {
            width: 25em;
        }
    </style>
    <script type="text/javascript">
        var MAX_NUM = 3;
        var API_KEY = '40a64f101b6e6406c562814a37bdb84a';
        var API_URL = 'http://tel.search.ch/api/';

        jQuery.support.cors = true; // Required - Enable cross domain requests;

        $(document).ready(function () {
            $("#searchBox").autocomplete({
                source: function (request, response) {
                    //Suggestions only after 4 letters in text field
                    if (request.term.length < 4) { return; }
                    $.ajax({
                        url: API_URL,
                        data: {
                            key: API_KEY,
                            q: request.term,
                            maxnum: MAX_NUM // Limit suggestions to 3
                        },
                        success: function (data, textStatus, xmlHttpRequest) {
                            entry = xmlHttpRequest.responseXML.getElementsByTagName('entry');
                            for (i = 0; i < entry.length; i++) {
                                alert(entry[i].childNodes[0].nodeName);
                                response($.map(data.geonames, function (item) {
                                    return {
                                        label: item.name + (item.adminName1 ? ", " + item.adminName1 : "") + ", " + item.countryName,
                                        value: item.name
                                    }
                                }));
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            alert(errorThrown);
                        }
                    });
                },
                minLength: 1,
                change: function (event, ui) {
                    if (!ui.item)
                        $("#searchBox").val('');
                },
                select: function (event, ui) {
                    displaySelectedItem(ui.item.data);
                }
            });
        });

        function displaySelectedItem(item) {
            $("#searchResult").empty().append('Result: ' + item.name).append(' (Latitude: ' + item.point.coordinates[0] + ' Longitude: ' + item.point.coordinates[1] + ')');
        }
    </script>
</head>
<body>
    <div>
        <div class="ui-widget">
            <label for="searchBox">
                Search:
            </label>
            <input id="searchBox" />
        </div>
        <div id="searchResult" class="ui-widget" style="margin-top: 1em;">
        </div>
    </div>
</body>
</html>
